#!/bin/bash

# File managed by Ansible, do not hand edit.

# Load per-host configuration
. {{dspace_install_dir}}/etc/conf.sh

# Maybe skip restart?
SKIP_RESTART=0
if [ "$1" == "--skip-restart" ] ; then
    SKIP_RESTART=1
fi


# make sure tomcat can open files that it may overwrite
sudo chown -R tomcat:tomcat "${DSPACE_RUN}" 

sudo -u tomcat  {{dspace_install_dir}}/bin/do_build.sh

# make sure SELinux context is right


if [ $SKIP_RESTART -eq 1 ];then
  echo "Skipping restart of tomcat"
else
  echo "Restarting tomcat"
  sudo systemctl restart tomcat
fi
